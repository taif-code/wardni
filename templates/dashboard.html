{% extends "base.html" %}
{% block content %}
<h2>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</h2>
<div class="cards">
  <div class="card">
    <div class="icon">ğŸšš</div>
    <div>
      <div class="label">Ø´Ø­Ù†Ø§Øª Ù‚ÙŠØ¯ Ø§Ù„Ù†Ù‚Ù„</div>
      <div class="metric">{{ in_transit|length }}</div>
    </div>
  </div>
  <div class="card">
    <div class="icon">ğŸŒ¡ï¸</div>
    <div>
      <div class="label">Ù…ØªÙˆØ³Ø· Ø§Ù„Ø­Ø±Ø§Ø±Ø©</div>
      <div class="metric">{{ avg_temp }}Â°C</div>
    </div>
  </div>
  <div class="card">
    <button class="icon" id="bell">ğŸ””</button>
    <div>
      <div class="label">ØªÙ†Ø¨ÙŠÙ‡Ø§Øª</div>
      <div class="metric">{{ alerts|length }}</div>
    </div>
  </div>
</div>

<ul id="alerts" class="alerts hidden">
  {% for a in alerts %}<li>{{ a }}</li>{% endfor %}
</ul>

<div class="grid2">
  <div class="panel">
    <h3>Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</h3>
    <div class="sub">Ø¹Ø¯Ø¯ Ø§Ù„Ø´Ø­Ù†Ø§Øª Ø§Ù„Ù†Ø§Ø¬Ø­Ø© (Ø¢Ø®Ø± 7 Ø£ÙŠØ§Ù…)</div>
    <canvas id="chart" height="180"></canvas>
  </div>
  <div class="panel">
    <h3>Ø§Ù„Ø´Ø­Ù†Ø§Øª</h3>
    <ul class="list">
      {% for s in shipments %}
      <li class="row">
        <div>ğŸ“¦ <strong>{{ s.id }}</strong><br><small>{{ s.origin }} â†’ {{ s.destination }}</small></div>
        <div class="muted">{{ s.status }} â€¢ {{ s.temp }}Â°C</div>
      </li>
      {% endfor %}
    </ul>
  </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
document.getElementById('bell').onclick = () => {
  document.getElementById('alerts').classList.toggle('hidden');
};
const ctx = document.getElementById('chart');
const data = {{ chart|tojson }}.map(x => x.success);
const labels = {{ chart|tojson }}.map(x => x.day);
new Chart(ctx, {type: 'line', data: {labels, datasets: [{label: 'Success', data, borderWidth: 2}]} , options:{responsive:true}});
</script>
{% endblock %}
